---
phase: 01-test-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .golangci.yml
autonomous: true

must_haves:
  truths:
    - "golangci-lint runs without configuration errors"
    - "All recommended linters are enabled (staticcheck, errcheck, govet, gosec, etc.)"
    - "Linter configuration enforces strict error checking (no unchecked errors allowed)"
    - "Style linters enforce import grouping and naming conventions"
    - "All existing code passes linting (violations fixed before merge)"
  artifacts:
    - path: ".golangci.yml"
      provides: "Linter configuration with strict settings"
      contains: "errcheck"
    - path: ".golangci.yml"
      provides: "Complexity limits"
      contains: "gocognit"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: ".golangci.yml"
      via: "golangci-lint-action reads config automatically"
      pattern: "golangci-lint"
---

<objective>
Create strict golangci-lint configuration for comprehensive static analysis

Purpose: Establish linting foundation that catches bugs, security issues, and code quality problems before merge. The configuration enforces errcheck (unchecked errors), gosec (security), staticcheck (bugs), and complexity limits. This is INFRA-02 from the roadmap.

Output: A `.golangci.yml` file that golangci-lint uses automatically in both local development and CI.
</objective>

<execution_context>
@/home/overlordyorch/.claude/get-shit-done/workflows/execute-plan.md
@/home/overlordyorch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-test-foundation/01-CONTEXT.md
@.planning/phases/01-test-foundation/01-RESEARCH.md
@Makefile
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create golangci-lint configuration with strict settings</name>
  <files>.golangci.yml</files>
  <action>
Create `.golangci.yml` with strict configuration based on research:

```yaml
# Strict golangci-lint configuration for pocket-relay-miner
# Based on community golden config: https://gist.github.com/maratori/47a4d00457a92aa426dbd48a18776322
run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

linters:
  enable:
    # Error handling (CRITICAL - per CLAUDE.md error handling requirements)
    - errcheck          # Unchecked errors
    - errorlint         # Error wrapping

    # Security
    - gosec             # Security problems

    # Code quality
    - staticcheck       # Go vet++
    - govet             # Official Go checker
    - ineffassign       # Unused assignments
    - unused            # Unused code

    # Complexity (STRICT - per user decision)
    - gocognit          # Cognitive complexity
    - gocyclo           # Cyclomatic complexity
    - funlen            # Function length

    # Style (enforces beyond gofmt)
    - goimports         # Import grouping
    - whitespace        # Extra whitespace

linters-settings:
  errcheck:
    check-blank: true           # error assignment to blank identifier
    check-type-assertions: true # unchecked type assertions

  gocognit:
    min-complexity: 15          # Cognitive complexity threshold (STRICT)

  gocyclo:
    min-complexity: 15          # Cyclomatic complexity threshold (STRICT)

  funlen:
    lines: 80                   # Max function lines (STRICT)
    statements: 50              # Max statements per function (STRICT)

issues:
  exclude-use-default: false    # No default exclusions
  max-issues-per-linter: 0      # Report all issues
  max-same-issues: 0            # Report all duplicates
```

Per 01-CONTEXT.md user decisions:
- "Strict everywhere - all code (existing and new) must pass linting"
- "No baseline approach - fix existing violations before merge"
- Strict errcheck with check-blank and check-type-assertions
- All recommended linters enabled
- Complexity thresholds are STRICT (gocognit:15, gocyclo:15, funlen:80 lines)

IMPORTANT: If existing code fails linting, you MUST fix the violations in this task before the config can be merged. This may involve:
1. Refactoring large functions (lifecycle_callback.go, session_lifecycle.go, proxy.go)
2. Handling unchecked errors
3. Splitting complex functions into smaller ones

Do NOT relax thresholds. Fix the code.
  </action>
  <verify>
Run `golangci-lint run --config .golangci.yml` from project root. Command must complete with zero violations (not just zero configuration errors).
  </verify>
  <done>
`.golangci.yml` file exists with strict settings. All existing code passes linting with zero violations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix any existing linter violations</name>
  <files>.golangci.yml, (affected source files)</files>
  <action>
Run golangci-lint and fix ALL violations before proceeding:

1. Run `golangci-lint run --config .golangci.yml` to get full violation list
2. For each violation category:
   - errcheck: Add explicit error handling or document with `//nolint:errcheck` with justification
   - gocognit/gocyclo: Refactor complex functions into smaller, focused functions
   - funlen: Split large functions into helper functions
   - gosec: Fix security issues or document with `//nolint:gosec` with justification

3. Use `//nolint` SPARINGLY and ONLY when there's a valid reason (e.g., test code, intentional design)
4. Each `//nolint` comment MUST include a reason: `//nolint:errcheck // intentionally ignoring error in test cleanup`

Per user decision: "No baseline approach - fix existing violations before merge"

This task may be substantial if there are many violations. Document the number of violations fixed and any `//nolint` additions.
  </action>
  <verify>
`golangci-lint run --config .golangci.yml` returns exit code 0 (no violations). Count of `//nolint` comments is documented.
  </verify>
  <done>
All linter violations fixed. Linter passes with zero violations. Any `//nolint` comments are documented with justification.
  </done>
</task>

</tasks>

<verification>
1. File `.golangci.yml` exists in project root
2. `golangci-lint run --config .golangci.yml` exits with code 0 (no violations)
3. All required linters are enabled: errcheck, errorlint, gosec, staticcheck, govet, ineffassign, unused, gocognit, gocyclo, funlen, goimports, whitespace
4. errcheck settings include check-blank: true and check-type-assertions: true
5. Complexity thresholds are strict: gocognit:15, gocyclo:15, funlen:80
6. Any `//nolint` comments have documented justification
</verification>

<success_criteria>
- `.golangci.yml` file committed to repository with strict settings
- Configuration is valid (no parse errors)
- Linter runs locally with ZERO violations
- CI will automatically use the config on next PR
- All existing violations fixed (not suppressed via relaxed thresholds)
</success_criteria>

<output>
After completion, create `.planning/phases/01-test-foundation/01-01-SUMMARY.md`
</output>

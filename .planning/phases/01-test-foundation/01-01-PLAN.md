---
phase: 01-test-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .golangci.yml
autonomous: true

must_haves:
  truths:
    - "golangci-lint runs without configuration errors"
    - "Error-checking linters are enabled strictly (errcheck, gosec, staticcheck)"
    - "Complexity linters are enabled with lenient thresholds (will tighten in Phase 4)"
    - "Style linters enforce import grouping and naming conventions"
    - "All existing code passes linting without production code changes"
  artifacts:
    - path: ".golangci.yml"
      provides: "Linter configuration with strict error checking"
      contains: "errcheck"
    - path: ".golangci.yml"
      provides: "Lenient complexity limits (to be tightened in Phase 4)"
      contains: "gocognit"
  key_links:
    - from: ".github/workflows/ci.yml"
      to: ".golangci.yml"
      via: "golangci-lint-action reads config automatically"
      pattern: "golangci-lint"
---

<objective>
Create golangci-lint configuration with strict error checking and lenient complexity thresholds

Purpose: Establish linting foundation that catches bugs and security issues (errcheck, gosec, staticcheck) without requiring production code refactoring in Phase 1. Complexity thresholds are intentionally lenient now (funlen:200, gocognit:40, gocyclo:40) and will be tightened in Phase 4 when refactoring is planned. This is INFRA-02 from the roadmap.

Output: A `.golangci.yml` file that golangci-lint uses automatically in both local development and CI.
</objective>

<execution_context>
@/home/overlordyorch/.claude/get-shit-done/workflows/execute-plan.md
@/home/overlordyorch/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-test-foundation/01-CONTEXT.md
@.planning/phases/01-test-foundation/01-RESEARCH.md
@Makefile
@.github/workflows/ci.yml
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create golangci-lint configuration with strict error checking and lenient complexity</name>
  <files>.golangci.yml</files>
  <action>
Create `.golangci.yml` with configuration based on user decision:
- ERROR CHECKING: STRICT (errcheck, gosec, staticcheck) - these catch bugs, not style
- COMPLEXITY: LENIENT (funlen:200, gocognit:40, gocyclo:40) - to be tightened in Phase 4

```yaml
# golangci-lint configuration for pocket-relay-miner
# Strategy: Strict error checking NOW, lenient complexity NOW (tighten in Phase 4)
# Based on community golden config: https://gist.github.com/maratori/47a4d00457a92aa426dbd48a18776322
run:
  timeout: 5m
  tests: true
  modules-download-mode: readonly

linters:
  enable:
    # Error handling (STRICT - catches bugs, per CLAUDE.md error handling requirements)
    - errcheck          # Unchecked errors - STRICT, no exceptions
    - errorlint         # Error wrapping patterns

    # Security (STRICT - catches vulnerabilities)
    - gosec             # Security problems - STRICT, no exceptions

    # Code quality (STRICT - catches bugs)
    - staticcheck       # Go vet++ - STRICT, no exceptions
    - govet             # Official Go checker
    - ineffassign       # Unused assignments
    - unused            # Unused code

    # Complexity (LENIENT - tighten in Phase 4 when refactoring is planned)
    - gocognit          # Cognitive complexity
    - gocyclo           # Cyclomatic complexity
    - funlen            # Function length

    # Style (enforces beyond gofmt)
    - goimports         # Import grouping
    - whitespace        # Extra whitespace

linters-settings:
  errcheck:
    check-blank: true           # error assignment to blank identifier - STRICT
    check-type-assertions: true # unchecked type assertions - STRICT

  # LENIENT thresholds - existing code passes without refactoring
  # Will be tightened in Phase 4: gocognit:15, gocyclo:15, funlen:80
  gocognit:
    min-complexity: 40          # Lenient (strict would be 15)

  gocyclo:
    min-complexity: 40          # Lenient (strict would be 15)

  funlen:
    lines: 200                  # Lenient (strict would be 80)
    statements: 100             # Lenient (strict would be 50)

issues:
  exclude-use-default: false    # No default exclusions
  max-issues-per-linter: 0      # Report all issues
  max-same-issues: 0            # Report all duplicates
```

User decision from revision context:
- "Relax thresholds in Phase 1, strict in Phase 4"
- Lenient complexity thresholds (funlen:200, gocognit:40, gocyclo:40)
- Strict errcheck/gosec/staticcheck (these catch bugs, not style)
- This maintains "no production code changes" phase boundary
  </action>
  <verify>
1. `golangci-lint run --config .golangci.yml` completes without configuration errors
2. Check that existing code passes with lenient complexity thresholds (may have errcheck/gosec/staticcheck violations to address in Task 2)
  </verify>
  <done>
`.golangci.yml` file exists with strict error checking (errcheck, gosec, staticcheck) and lenient complexity thresholds (funlen:200, gocognit:40, gocyclo:40).
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix errcheck/gosec/staticcheck violations only</name>
  <files>.golangci.yml, (affected source files - minimal changes)</files>
  <action>
Run golangci-lint and fix ONLY errcheck, gosec, and staticcheck violations:

1. Run `golangci-lint run --config .golangci.yml` to get violation list
2. For each violation, handle by category:

   **errcheck violations (unchecked errors):**
   - Add explicit error handling with logging, OR
   - Use `_ =` for intentionally ignored returns with comment, OR
   - Add `//nolint:errcheck // <justification>` for truly ignorable cases

   **gosec violations (security issues):**
   - Fix security issues if trivial (e.g., hardcoded credentials in tests)
   - Add `//nolint:gosec // <justification>` only if false positive

   **staticcheck violations (bugs):**
   - Fix the bug, OR
   - Add `//nolint:staticcheck // <justification>` if false positive

3. DO NOT refactor for complexity violations - those are intentionally lenient
4. DO NOT fix time.Sleep() violations in test files - those are test quality issues for Phase 3
5. Each `//nolint` comment MUST include a reason

Changes should be MINIMAL - only what's needed to pass errcheck/gosec/staticcheck.
No function splitting, no major refactoring - that's Phase 4 work.
  </action>
  <verify>
1. `golangci-lint run --config .golangci.yml` returns exit code 0 (no violations)
2. No complexity-related changes were made (grep for funlen/gocognit/gocyclo violations should show none due to lenient thresholds)
3. Count of `//nolint` comments is documented
  </verify>
  <done>
All errcheck/gosec/staticcheck violations fixed with minimal changes. Linter passes with zero violations. Any `//nolint` comments are documented with justification.
  </done>
</task>

</tasks>

<verification>
1. File `.golangci.yml` exists in project root
2. `golangci-lint run --config .golangci.yml` exits with code 0 (no violations)
3. All required linters are enabled: errcheck, errorlint, gosec, staticcheck, govet, ineffassign, unused, gocognit, gocyclo, funlen, goimports, whitespace
4. errcheck settings include check-blank: true and check-type-assertions: true (STRICT)
5. Complexity thresholds are LENIENT: gocognit:40, gocyclo:40, funlen:200 lines
6. Any `//nolint` comments have documented justification
7. No production code was refactored for complexity (that's Phase 4)
</verification>

<success_criteria>
- `.golangci.yml` file committed to repository with strict error checking + lenient complexity
- Configuration is valid (no parse errors)
- Linter runs locally with ZERO violations
- CI will automatically use the config on next PR
- Only errcheck/gosec/staticcheck violations were fixed (no complexity refactoring)
- Phase boundary maintained: no major production code changes
</success_criteria>

<output>
After completion, create `.planning/phases/01-test-foundation/01-01-SUMMARY.md`
</output>
